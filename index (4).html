<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>PrepApp - Fixed</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --primary-card-color: #1e1e1e;
            --secondary-card-color: #2a2a2a;
            --primary-accent-color: #9b59b6;
            --secondary-accent-color: #8e44ad;
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --font-family: 'Poppins', 'Segoe UI', 'Roboto', sans-serif;
            --card-border-radius: 16px;
            --button-border-radius: 10px;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{
            font-family:var(--font-family);
            background-color:var(--bg-color);
            color:var(--text-color);
            display:flex;
            justify-content:center;
            align-items:center;
            min-height:100vh;
            padding:1rem;
        }
        .container{
            width:100%;
            max-width:900px;
            height:95vh;
            background-color:var(--primary-card-color);
            border-radius:20px;
            box-shadow:0 10px 40px rgba(0,0,0,0.5);
            overflow:hidden;
            display:flex;
            flex-direction:column;
        }
        .app-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:1rem 1.5rem;
            background-color:rgba(0,0,0,0.2);
            border-bottom:1px solid rgba(255,255,255,0.06);
        }
        .logo{font-size:1.4rem;font-weight:600}
        .profile-btn{width:44px;height:44px;border-radius:50%;background:linear-gradient(45deg,var(--primary-accent-color),var(--secondary-accent-color));color:#fff;border:none;cursor:pointer;font-weight:600}
        .screen{flex:1;padding:1.25rem;overflow:auto}
        .hidden{display:none!important}
        .auth-form{max-width:360px;width:100%;display:flex;flex-direction:column;gap:1rem}
        input[type="text"],input[type="email"],input[type="password"]{
            padding:0.9rem 1rem;border-radius:10px;border:1px solid var(--secondary-card-color);background:transparent;color:var(--text-color)
        }
        button{padding:0.9rem 1rem;border-radius:10px;border:none;background:linear-gradient(45deg,var(--primary-accent-color),var(--secondary-accent-color));color:#fff;cursor:pointer}
        .toggle-form{color:var(--primary-accent-color);cursor:pointer;text-align:center}
        .subject-card{display:flex;gap:1rem;align-items:center;padding:1rem;border-radius:14px;background:var(--secondary-card-color);cursor:pointer;border:1px solid transparent}
        .subject-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,0,0,0.2)}
        .icon{font-size:1.8rem;width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:var(--bg-color)}
        .flashcard-container{perspective:1000px;width:100%;max-width:520px;height:270px;margin:1rem auto}
        .flashcard{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.6s;cursor:pointer}
        .flashcard.is-flipped{transform:rotateY(180deg)}
        .flashcard-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;padding:1.25rem;border-radius:12px;background:var(--secondary-card-color);font-size:1.2rem;text-align:center}
        .flashcard-back{transform:rotateY(180deg)}
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:1000}
        .modal-content{background:var(--secondary-card-color);padding:1.5rem;border-radius:12px;width:90%;max-width:420px}
        .back-button{background:transparent;border:1px solid var(--primary-accent-color);color:var(--primary-accent-color);padding:0.6rem 0.9rem;border-radius:8px;cursor:pointer}
        .topic-card{border-radius:12px;background:var(--secondary-card-color);overflow:hidden;border:1px solid rgba(255,255,255,0.04);margin-bottom:0.9rem}
        .topic-card-content{padding:1rem}
        .topic-card-actions{display:flex;gap:0.6rem;padding:0.6rem;background:rgba(0,0,0,0.12)}
        .topic-action-btn{flex:1;padding:0.6rem;border-radius:8px;border:none;cursor:pointer}
        .quiz-option{padding:0.9rem;border-radius:10px;border:2px solid var(--secondary-card-color);background:transparent;cursor:pointer;text-align:left}
    </style>
</head>
<body>
    <div class="container">
        <header class="app-header hidden" id="app-header">
            <div class="logo">PrepApp</div>
            <button id="profile-btn" class="profile-btn">P</button>
        </header>

        <main id="auth-screen" class="screen">
            <h1 style="text-align:center;margin-bottom:1rem">Welcome to PrepApp</h1>
            <div style="display:flex;justify-content:center">
                <div id="auth-container">
                    <form id="login-form" class="auth-form">
                        <h2>Login</h2>
                        <input id="login-email" type="email" placeholder="Email" required />
                        <input id="login-password" type="password" placeholder="Password" required />
                        <button type="submit">Login</button>
                        <p class="auth-error" id="login-error" style="min-height:1.1em;color:var(--error-color)"></p>
                        <p class="toggle-form" id="show-signup">Don't have an account? Sign Up</p>
                    </form>

                    <form id="signup-form" class="auth-form hidden">
                        <h2>Sign Up</h2>
                        <input id="signup-name" type="text" placeholder="Full name" required />
                        <input id="signup-email" type="email" placeholder="Email" required />
                        <input id="signup-password" type="password" placeholder="Password" required />
                        <button type="submit">Sign Up</button>
                        <p class="auth-error" id="signup-error" style="min-height:1.1em;color:var(--error-color)"></p>
                        <p class="toggle-form" id="show-login">Already have an account? Login</p>
                    </form>
                </div>
            </div>
        </main>

        <main id="dashboard-screen" class="screen hidden">
            <h1 style="text-align:center">Subjects</h1>
            <div style="margin:0.8rem 0;display:flex;gap:0.6rem;align-items:center">
                <input id="search-bar" type="text" placeholder="Search subjects..." style="flex:1;padding:0.7rem;border-radius:8px;border:1px solid var(--secondary-card-color);background:transparent;color:var(--text-color)">
            </div>
            <div id="subject-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:0.9rem"></div>
        </main>

        <main id="topics-screen" class="screen hidden">
            <button class="back-button" data-target="dashboard-screen">&larr; Back to Subjects</button>
            <h1 id="topic-title" style="margin-top:1rem"></h1>
            <div id="topic-list" style="margin-top:0.9rem"></div>
        </main>

        <main id="flashcard-screen" class="screen hidden">
            <button class="back-button" data-target="topics-screen">&larr; Back to Topics</button>
            <h1 id="flashcard-topic-title" style="margin-top:0.8rem">Flashcards</h1>
            <div id="flashcard-counter" style="text-align:center;margin:0.5rem 0">Card 0 / 0</div>
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-face flashcard-front" id="flashcard-question"></div>
                    <div class="flashcard-face flashcard-back" id="flashcard-answer"></div>
                </div>
            </div>
            <div style="display:flex;gap:0.6rem;justify-content:center">
                <button id="flashcard-prev" style="padding:0.6rem 0.9rem">← Prev</button>
                <button id="flashcard-next" style="padding:0.6rem 0.9rem">Next →</button>
            </div>
        </main>

        <main id="quiz-screen" class="screen hidden">
            <button class="back-button" data-target="topics-screen">&larr; Back to Topics</button>
            <h1 id="quiz-topic-title" style="margin-top:0.8rem">Quiz</h1>
            <div id="quiz-question" style="margin:1.2rem 0;font-size:1.1rem;font-weight:500"></div>
            <div id="quiz-options" style="display:grid;gap:0.6rem"></div>
        </main>

        <div id="quiz-result-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="quiz-result-title">Quiz Completed!</h2>
                <p id="quiz-result-text"></p>
                <div style="display:flex;gap:0.8rem;margin-top:1rem">
                    <button id="quiz-retry-btn" style="flex:1">Retry</button>
                    <button id="quiz-back-to-topics-btn" style="flex:1;background:var(--secondary-card-color)">Back to Topics</button>
                </div>
            </div>
        </div>

        <div id="profile-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <button id="profile-modal-close" style="position:absolute;right:18px;top:10px;border:none;background:none;font-size:1.4rem;color:var(--text-color)">✕</button>
                <h2>Profile</h2>
                <div style="display:flex;gap:0.8rem;align-items:center;margin:0.8rem 0">
                    <div id="profile-avatar-initials" style="width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(45deg,var(--primary-accent-color),var(--secondary-accent-color));color:#fff;font-weight:700">P</div>
                    <div>
                        <h3 id="profile-name" style="margin-bottom:0.2rem">User</h3>
                        <p id="profile-email" style="color:var(--text-muted)">user@example.com</p>
                    </div>
                </div>
                <div style="display:flex;flex-direction:column;gap:0.6rem">
                    <div style="display:flex;justify-content:space-between">
                        <span>User ID</span>
                        <div><strong id="profile-uid">-</strong> <button id="copy-uid-btn" style="margin-left:0.5rem;padding:0.2rem 0.4rem;border-radius:6px;border:1px solid var(--text-muted);background:none;color:var(--text-muted)">Copy</button></div>
                    </div>
                    <div style="display:flex;justify-content:space-between">
                        <span>Flashcards Completed</span>
                        <strong id="profile-flashcards-completed">0</strong>
                    </div>
                </div>
                <div style="margin-top:0.9rem">
                    <button id="sign-out-btn" style="background:var(--error-color);width:100%">Sign Out</button>
                </div>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // ----- App data (kept simple) -----
    const quizData = [
        { subject: "Math", icon: "🔢", topics: [
            { title: "Algebra Basics", flashcards: [{ q: "2x+3=7 ?", a: "x = 2" }], quiz: [{ q: "5x-10=15 ?", o: ["x=5","x=3"], c: 0 }] },
            { title: "Geometry", flashcards: [{ q: "Circle Area ?", a: "πr²" }], quiz: [{ q: "Pythagorean theorem ?", o: ["a²+b²=c²","a+b=c"], c: 0 }] }
        ]},
        { subject: "Science", icon: "🔬", topics: [
            { title: "Human Biology", flashcards: [{ q: "Powerhouse of cell ?", a: "Mitochondria" }], quiz: [{ q: "Plants absorb ?", o: ["O2","CO2"], c: 1 }] }
        ]},
        { subject: "History", icon: "🏛️", topics: [
            { title: "World War II", flashcards: [{ q: "WWII Start ?", a: "1939" }], quiz: [{ q: "WWII Trigger ?", o: ["Poland invasion","Pearl Harbor"], c: 0 }] }
        ]},
        { subject: "English", icon: "📚", topics: [
            { title: "Grammar Basics", flashcards: [{ q: "What is a verb ?", a: "An action word" }], quiz: [{ q: "Happy synonym ?", o: ["Joyful","Sad"], c: 0 }] }
        ]}
    ];

    // ----- UI refs -----
    const screens = document.querySelectorAll('.screen');
    const appHeader = document.getElementById('app-header');
    const subjectGrid = document.getElementById('subject-grid');
    const topicList = document.getElementById('topic-list');
    const topicTitle = document.getElementById('topic-title');
    const flashcardQuestion = document.getElementById('flashcard-question');
    const flashcardAnswer = document.getElementById('flashcard-answer');
    const flashcardEl = document.getElementById('flashcard');
    const flashcardCounter = document.getElementById('flashcard-counter');
    const quizQuestionEl = document.getElementById('quiz-question');
    const quizOptionsEl = document.getElementById('quiz-options');
    const quizResultModal = document.getElementById('quiz-result-modal');
    const quizResultText = document.getElementById('quiz-result-text');

    const profileBtn = document.getElementById('profile-btn');
    const profileModal = document.getElementById('profile-modal');
    const profileNameEl = document.getElementById('profile-name');
    const profileEmailEl = document.getElementById('profile-email');
    const profileUidEl = document.getElementById('profile-uid');
    const profileInitials = document.getElementById('profile-avatar-initials');
    const signOutBtn = document.getElementById('sign-out-btn');

    // ----- State -----
    let currentUser = null;
    let userProfile = null;
    let currentSubjectIndex = 0;
    let currentTopicIndex = 0;
    let currentFlashcardIndex = 0;
    let currentQuizQuestionIndex = 0;
    let currentQuizQuestions = [];
    let quizScore = 0;

    // ----- Firebase init (safe guarded) -----
    let auth = null, db = null;
    try {
        const firebaseConfig = {
          apiKey: "AIzaSyBfXKk7mGY8zb8zg-ryLinyNfVgxvuVXNY",
          authDomain: "quizzes-ab6e0.firebaseapp.com",
          projectId: "quizzes-ab6e0",
          storageBucket: "quizzes-ab6e0.firebasestorage.app",
          messagingSenderId: "612693707796",
          appId: "1:612693707796:web:dca199a228cecef341ab01"
        };
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
    } catch (err) {
        console.warn('Firebase not available, using local fallback auth.', err);
    }

    // ----- Auth UI toggles -----
    document.getElementById('show-signup').addEventListener('click', () => {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('signup-form').classList.remove('hidden');
    });
    document.getElementById('show-login').addEventListener('click', () => {
        document.getElementById('signup-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
    });

    // ----- Local fallback auth helpers -----
    function saveLocalUser(email, password, name) {
        const users = JSON.parse(localStorage.getItem('prep_users') || '{}');
        const id = 'local_' + (Object.keys(users).length + 1);
        users[id] = { id, email, password, name };
        localStorage.setItem('prep_users', JSON.stringify(users));
        return users[id];
    }
    function findLocalUserByEmail(email) {
        const users = JSON.parse(localStorage.getItem('prep_users') || '{}');
        return Object.values(users).find(u => u.email === email);
    }

    // ----- Signup/Login handlers -----
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('signup-name').value.trim();
        const email = document.getElementById('signup-email').value.trim();
        const password = document.getElementById('signup-password').value;
        if (auth) {
            // use firebase
            try {
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                await db.collection('users').doc(cred.user.uid).set({ full_name: name, email });
                // firebase will call onAuthStateChanged and initialize app
            } catch (err) {
                document.getElementById('signup-error').textContent = err.message;
            }
        } else {
            // local fallback
            if (findLocalUserByEmail(email)) {
                document.getElementById('signup-error').textContent = 'Email already registered (local)';
                return;
            }
            const u = saveLocalUser(email, password, name);
            // login user locally
            localStorage.setItem('prep_current_user', JSON.stringify(u));
            initializeAppLocal(u);
        }
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        if (auth) {
            try {
                await auth.signInWithEmailAndPassword(email, password);
                // onAuthStateChanged will handle initialize
            } catch (err) {
                document.getElementById('login-error').textContent = err.message;
            }
        } else {
            const u = findLocalUserByEmail(email);
            if (!u || u.password !== password) {
                document.getElementById('login-error').textContent = 'Invalid credentials (local)';
                return;
            }
            localStorage.setItem('prep_current_user', JSON.stringify(u));
            initializeAppLocal(u);
        }
    });

    // Firebase auth listener OR local init
    if (auth) {
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                // fetch profile from firestore
                try {
                    const doc = await db.collection('users').doc(user.uid).get();
                    userProfile = doc.exists ? doc.data() : { full_name: user.email, email: user.email };
                } catch (err) {
                    userProfile = { full_name: user.email, email: user.email };
                }
                initializeApp();
            } else {
                currentUser = null;
                showScreen('auth-screen');
                appHeader.classList.add('hidden');
            }
        });
    } else {
        // check local storage for current user
        const local = localStorage.getItem('prep_current_user');
        if (local) {
            const u = JSON.parse(local);
            initializeAppLocal(u);
        } else {
            showScreen('auth-screen');
        }
    }

    // ----- Local init -----
    function initializeAppLocal(localUser) {
        currentUser = localUser;
        userProfile = { full_name: localUser.name || 'User', email: localUser.email || '' };
        initializeApp();
    }

    // ----- Common init after login -----
    function initializeApp() {
        renderDashboard();
        setupEventListeners();
        showScreen('dashboard-screen');
        appHeader.classList.remove('hidden');
        // populate profile header initials
        profileInitials.textContent = (userProfile && userProfile.full_name) ? userProfile.full_name.split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase() : 'P';
        profileNameEl.textContent = userProfile && userProfile.full_name ? userProfile.full_name : (currentUser.email || 'User');
        profileEmailEl.textContent = userProfile && userProfile.email ? userProfile.email : (currentUser.email || '');
        profileUidEl.textContent = currentUser && currentUser.uid ? currentUser.uid : (currentUser.id || '-');
        profileUidEl.dataset.fullId = profileUidEl.textContent;
    }

    // ----- Basic navigation -----
    function showScreen(screenId) {
        screens.forEach(s => s.classList.add('hidden'));
        const el = document.getElementById(screenId);
        if (el) el.classList.remove('hidden');
    }

    // ----- Render dashboard subjects -----
    function renderDashboard() {
        subjectGrid.innerHTML = '';
        quizData.forEach((subject, idx) => {
            const card = document.createElement('div');
            card.className = 'subject-card';
            card.dataset.index = idx;
            card.innerHTML = `<div class="icon">${subject.icon}</div>
                <div style="flex:1">
                    <h3 style="margin-bottom:0.35rem">${subject.subject}</h3>
                    <div style="height:8px;background:var(--bg-color);border-radius:6px;overflow:hidden">
                        <div style="width:20%;height:100%;background:linear-gradient(90deg,var(--primary-accent-color),var(--secondary-accent-color))"></div>
                    </div>
                </div>`;
            subjectGrid.appendChild(card);
        });
    }

    // ----- Topics rendering -----
    function renderTopics(subjectIndex) {
        currentSubjectIndex = subjectIndex;
        const subject = quizData[subjectIndex];
        topicTitle.textContent = subject.subject;
        topicList.innerHTML = '';
        subject.topics.forEach((topic, idx) => {
            const card = document.createElement('div');
            card.className = 'topic-card';
            card.innerHTML = `<div class="topic-card-content">
                    <h3 style="margin:0 0 6px">${topic.title}</h3>
                    <p style="color:var(--text-muted);margin:0">${topic.flashcards.length} Flashcards • ${topic.quiz.length} Quiz Questions</p>
                </div>
                <div class="topic-card-actions">
                    <button class="topic-action-btn flashcard-btn" data-index="${idx}">🃏 Flashcards</button>
                    <button class="topic-action-btn quiz-btn" data-index="${idx}" style="background:linear-gradient(45deg,var(--primary-accent-color),var(--secondary-accent-color));color:#fff">🧠 Start Quiz</button>
                </div>`;
            topicList.appendChild(card);
        });
        showScreen('topics-screen');
    }

    // ----- Event listeners -----
    function setupEventListeners() {
        // subject click -> topics
        subjectGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.subject-card');
            if (!card) return;
            renderTopics(parseInt(card.dataset.index));
        });

        // back buttons
        document.querySelectorAll('.back-button').forEach(btn => {
            btn.addEventListener('click', () => showScreen(btn.dataset.target));
        });

        // topic actions
        topicList.addEventListener('click', (e) => {
            const btn = e.target.closest('.topic-action-btn');
            if (!btn) return;
            const topicIndex = parseInt(btn.dataset.index);
            if (btn.classList.contains('flashcard-btn')) startFlashcards(topicIndex);
            else if (btn.classList.contains('quiz-btn')) startQuiz(topicIndex);
        });

        // flashcard flip and nav
        flashcardEl.addEventListener('click', () => flashcardEl.classList.toggle('is-flipped'));
        document.getElementById('flashcard-prev').addEventListener('click', () => {
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                renderFlashcard();
            }
        });
        document.getElementById('flashcard-next').addEventListener('click', () => {
            const topic = quizData[currentSubjectIndex].topics[currentTopicIndex];
            if (currentFlashcardIndex < topic.flashcards.length - 1) {
                currentFlashcardIndex++;
                renderFlashcard();
            }
        });

        // quiz modal buttons
        document.getElementById('quiz-retry-btn').addEventListener('click', () => {
            quizResultModal.classList.add('hidden');
            startQuiz(currentTopicIndex);
        });
        document.getElementById('quiz-back-to-topics-btn').addEventListener('click', () => {
            quizResultModal.classList.add('hidden');
            showScreen('topics-screen');
        });

        // profile
        profileBtn.addEventListener('click', openProfileModal);
        document.getElementById('profile-modal-close').addEventListener('click', () => profileModal.classList.add('hidden'));
        document.getElementById('copy-uid-btn').addEventListener('click', () => copyToClipboard(profileUidEl.dataset.fullId || profileUidEl.textContent));
        signOutBtn.addEventListener('click', async () => {
            if (auth) {
                await auth.signOut();
            } else {
                localStorage.removeItem('prep_current_user');
                location.reload();
            }
        });

        // search
        document.getElementById('search-bar').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.subject-card').forEach(card => {
                const name = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = name.includes(term) ? 'flex' : 'none';
            });
        });
    }

    // ----- Flashcards -----
    function startFlashcards(topicIndex) {
        currentTopicIndex = topicIndex;
        currentFlashcardIndex = 0;
        const topic = quizData[currentSubjectIndex].topics[currentTopicIndex];
        document.getElementById('flashcard-topic-title').textContent = topic.title + ' - Flashcards';
        renderFlashcard();
        showScreen('flashcard-screen');
    }

    function renderFlashcard() {
        const topic = quizData[currentSubjectIndex].topics[currentTopicIndex];
        const card = topic.flashcards[currentFlashcardIndex];
        flashcardQuestion.textContent = card.q;
        flashcardAnswer.textContent = card.a;
        flashcardEl.classList.remove('is-flipped');
        flashcardCounter.textContent = `Card ${currentFlashcardIndex + 1} / ${topic.flashcards.length}`;
        // update profile progress count (simple)
        document.getElementById('profile-flashcards-completed').textContent = (currentFlashcardIndex + 1);
    }

    // ----- Quiz -----
    function startQuiz(topicIndex) {
        currentTopicIndex = topicIndex;
        currentQuizQuestionIndex = 0;
        quizScore = 0;
        currentQuizQuestions = quizData[currentSubjectIndex].topics[currentTopicIndex].quiz || [];
        document.getElementById('quiz-topic-title').textContent = quizData[currentSubjectIndex].topics[currentTopicIndex].title + ' - Quiz';
        renderQuizQuestion();
        showScreen('quiz-screen');
    }

    function renderQuizQuestion() {
        if (currentQuizQuestionIndex >= currentQuizQuestions.length) {
            // finished
            quizResultText.textContent = `Your score: ${quizScore} / ${currentQuizQuestions.length}`;
            quizResultModal.classList.remove('hidden');
            return;
        }
        const q = currentQuizQuestions[currentQuizQuestionIndex];
        quizQuestionEl.textContent = q.q;
        quizOptionsEl.innerHTML = '';
        q.o.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'quiz-option';
            btn.textContent = opt;
            btn.addEventListener('click', () => {
                handleQuizAnswer(idx);
            });
            quizOptionsEl.appendChild(btn);
        });
    }

    function handleQuizAnswer(selectedIndex) {
        const q = currentQuizQuestions[currentQuizQuestionIndex];
        const buttons = Array.from(quizOptionsEl.querySelectorAll('button'));
        buttons.forEach(b => b.disabled = true);
        // mark correct/incorrect
        buttons.forEach((b, i) => {
            if (i === q.c) b.classList.add('correct');
            if (i === selectedIndex && i !== q.c) b.classList.add('incorrect');
        });
        if (selectedIndex === q.c) quizScore++;
        // next after short delay
        setTimeout(() => {
            currentQuizQuestionIndex++;
            renderQuizQuestion();
        }, 700);
    }

    // ----- Profile modal -----
    function openProfileModal() {
        profileModal.classList.remove('hidden');
    }

    function copyToClipboard(text) {
        if (!text) return;
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard');
            });
        } else {
            const ta = document.createElement('textarea');
            ta.value = text; document.body.appendChild(ta);
            ta.select(); document.execCommand('copy'); ta.remove();
            alert('Copied to clipboard');
        }
    }

    // expose some functions to console for debugging (optional)
    window._prep = { quizData, renderDashboard, renderTopics };

});
</script>
</body>
</html>
<script type="text/javascript">
	atOptions = {
		'key' : 'b8ebb65be0fe08132554235a7f1756a8',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript">
	atOptions = {
		'key' : '76110e65af4374db87fab6d3221631e5',
		'format' : 'iframe',
		'height' : 600,
		'width' : 160,
		'params' : {}
	};
</script>